<div class="p-3">
  <div class="flex align-items-center justify-content-between mb-3">
    <div>
      <h2 class="m-0">Logs</h2>
      <small class="text-500">Historial básico de operaciones (CRYPTO / MARKET)</small>
    </div>
  </div>

  <div class="p-card p-3 mb-3">
    <form [formGroup]="form" class="grid">
      <div class="col-12 md:col-5">
        <label class="block mb-2">Portfolio ID</label>
        <input pInputText formControlName="portfolioId" placeholder="uuid..." />
      </div>

      <div class="col-12 md:col-5">
        <label class="block mb-2">Asset ID</label>
        <input pInputText formControlName="assetId" placeholder="uuid..." />
      </div>

      <div class="col-12 md:col-2 flex align-items-end gap-2">
        <button pButton type="button" label="Buscar" icon="pi pi-search" (click)="onSearch()"></button>
        <button pButton type="button" label="Reset" icon="pi pi-refresh" class="p-button-secondary" (click)="onReset()"></button>
      </div>
    </form>
  </div>

  <p-table
    [value]="items"
    [loading]="loading"
    [paginator]="true"
    [rows]="limit"
    [totalRecords]="total"
    [lazy]="true"
    (onLazyLoad)="onPageChange($event)"
    [rowsPerPageOptions]="[20, 50, 100]"
    responsiveLayout="scroll"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>Fecha</th>
        <th>Portfolio</th>
        <th>Asset</th>
        <th>Acción</th>
        <th>Old → New</th>
        <th>Delta</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-row>
      <tr>
        <td>{{ row.createdAt | date:'yyyy-MM-dd HH:mm' }}</td>

        <td>
          <div class="font-medium">{{ row.portfolio?.name || row.portfolioId }}</div>
        </td>

        <td>
          <div class="font-medium">
            {{ row.asset?.symbol || row.asset?.name || row.assetId }}
          </div>
          <small class="text-500">{{ row.asset?.name }}</small>
        </td>

        <td>
          <p-tag [severity]="actionSeverity(row.action)" [value]="actionLabel(row.action)"></p-tag>
        </td>

        <td>
          {{ formatQty(row.oldQuantity) }} → <b>{{ row.newQuantity }}</b>
        </td>

        <td>
          <span [class]="row.deltaQuantity.startsWith('-') ? 'text-red-400' : 'text-green-400'">
            {{ row.deltaQuantity }}
          </span>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="6">No hay logs con esos filtros.</td>
      </tr>
    </ng-template>
  </p-table>
</div>
