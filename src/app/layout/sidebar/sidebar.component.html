<div class="sidebar-wrap" *ngIf="user$ | async as user">
  <div class="sidebar-header">
    <div class="fw-semibold">Portfolios</div>
    <div class="text-muted small">{{ user.email }}</div>
  </div>

  <div class="px-3 pb-3">
    <div *ngIf="loading" class="text-muted small">Cargando...</div>
    <div *ngIf="error" class="text-danger small">{{ error }}</div>
  </div>

  <div class="sidebar-body" *ngIf="!loading && !error">
    <ng-container *ngFor="let root of roots; trackBy: trackById">
      <a
        class="sidebar-item sidebar-root"
        [routerLink]="['/dashboard']"
        [queryParams]="{ portfolioId: root.id }"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: false }"
        (click)="closeOnMobile()"
      >
        {{ root.name }}
      </a>

      <div class="sidebar-children" *ngIf="root.children?.length">
        <ng-container *ngFor="let child of root.children; trackBy: trackById">
          <a
            class="sidebar-item"
            [routerLink]="['/dashboard']"
            [queryParams]="{ portfolioId: child.id }"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: false }"
            (click)="closeOnMobile()"
          >
            {{ child.name }}
          </a>

          <!-- 1 nivel mÃ¡s (simple). Si quieres infinito, lo hacemos recursivo con componente. -->
          <div class="sidebar-children" *ngIf="child.children?.length">
            <ng-container *ngFor="let sub of child.children; trackBy: trackById">
              <a
                class="sidebar-item"
                [routerLink]="['/dashboard']"
                [queryParams]="{ portfolioId: sub.id }"
                routerLinkActive="active"
                [routerLinkActiveOptions]="{ exact: false }"
                (click)="closeOnMobile()"
              >
                {{ sub.name }}
              </a>
            </ng-container>
          </div>
        </ng-container>
      </div>
    </ng-container>
  </div>
</div>
